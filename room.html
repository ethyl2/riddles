<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <![endif]-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Can you solve the riddle and escape?">
    <meta property="og:image" content="https://ethyl2.github.io/riddles/images/riddles_in_the_dark.png" />
    <meta property="og:title" content="Riddles in the Dark" />
    <meta property="og:url" content="https://ethyl2.github.io/riddles/" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Can you find and solve the riddles?" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@ethyl22">
    <meta name="twitter:title" content="Riddles in the Dark">
    <meta name="twitter:description" content="Can you solve the riddle and escape?">
    <meta name="twitter:image" content="https://ethyl2.github.io/riddles/images/riddles_in_the_dark.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Knewave&display=swap&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="shortcut icon" href="favicon.ico?" type="image/x-icon">
    <link rel="icon" type="image/x-icon" href="favicon.ico?">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen mb-0 overflow-x-auto select-none" style="background:#2e2a20;">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <header>
        <h1 class="py-4 text-2xl text-center text-black neon-text md:text-3xl"
            style="font-family: 'Knewave', cursive;">
            riddles in the dark
        </h1>

        <p class="text-center text-black select-none text-lg md:text-xl"
            style="font-family: 'Knewave', cursive; text-shadow: 0 0 4px #fff, 0 0 11px #fff, 0 0 19px #fff;""
        >
            welcome to the <span class="room-name"></span>!
        </p>
    </header>

    <main class="min-h-screen container mx-auto mt-12 flex flex-col items-center justify-start">
        <div class="w-full md:w-1/2">
            <img id="current-room" src="./images/art-room.png" alt="riddle room" class="w-full border-8 border-zinc-700"/>
        </div>

        <p class="px-2 pt-4 pb-2 text-center" style="font-family: 'Knewave', cursive; text-shadow: 0 0 4px #fff, 0 0 11px #fff, 0 0 19px #fff;">
            You are now locked in the <span class="room-name"></span>. <br class="md:hidden"/>Answer this to excape:</p>
        <p id="current-riddle"
            class="text-lg md:text-3xl text-white select-none py-8 tracking-wide px-4 text-center font-thin" style="font-family: 'Kalam', cursive;">
            What word starts with <span class="italic">'e'</span> and ends with <span class="italic">'e'</span>, but usually has only one letter in it?
        </p>

        <!-- FORM SECTION -->
      <div class="flex items-center justify-center flex-col">
        <form
          id="answer-form"
          class="p-4 flex flex-col items-center justify-center space-y-2 sm:p-8 sm:space-y-0 sm:flex-row sm:space-x-3"
        >
            <label
            for="riddle-answer"
            class="text-black select-none md:pr-2"
            style="font-family: 'Knewave', cursive; text-shadow: 0 0 4px #fff, 0 0 11px #fff, 0 0 19px #fff;"
            >
            what's the answer?
            </label>
            <input
            id="riddle-answer"
            type="text"
            class="p-1 border rounded md:mr-2"
            name="riddle-answer"
            />
            <div class="flex items-center justify-center space-x-2">
                <button
                    id="submit"
                    type="submit"
                    class="px-2 py-1 font-medium text-yellow-300 bg-gray-500 rounded cursor-not-allowed"
                    disabled
                >
                    submit
                </button>
                <button
                    id="give-up"
                    type="button"
                    class="px-2 py-1 font-medium text-yellow-300 bg-black rounded hover:bg-gray-800 focus:bg-gray-600 border border-black"
                >
                    give up?
                </button>
            </div>
        </form>

        <!-- RESPONSE SECTION -->
        <p
        id="response"
        class="font-medium text-center select-none px-4"
        style="font-family: 'Knewave', cursive; text-shadow: 0 0 4px #fff, 0 0 11px #fff, 0 0 19px #fff;"
        >
        </p>

        <!-- BUTTON SECTION -->
        <div class="flex items-center justify-center mt-2 sm:mt-6">
        <a
            id="go-home"
            type="button"
            class="p-2 font-medium text-yellow-300 bg-black rounded hover:bg-gray-800 focus:bg-gray-600 hidden"
            href="./room-grid.html"
        >
            leave while you can
        </a>
        </div>
      </div>
    </main>
   
    <!-- FOOTER -->
    <footer class="relative px-4 pt-8 pb-16 mt-12 mb-0 text-center bg-zinc-700 sm:mt-32">
        <nav class="flex items-stretch justify-center space-x-2 max-w-sm mx-auto pb-4">
            <a href="./index.html" title="home tour" class="w-1/4 bg-gray-800 p-2 rounded flex flex-col items-center justify-center hover:bg-gray-500">
            <img src="images/orange-eyes.png" alt="eyes" class="w-8 h-8 md:w-16 md:h-16"/>
            <span style="font-family: 'Knewave', cursive;" class="text-xs text-yellow-500">back to the dark?</span>
            </a>
            <a href="./more-riddles.html" title="more riddles" class="w-1/4 bg-yellow-300 p-2 rounded flex flex-col items-center justify-center hover:bg-yellow-400">
            <img src="images/owl.png" alt="owl" class="w-8 h-8 md:w-16 md:h-16"/>
            <span style="font-family: 'Knewave', cursive;" class="text-xs">more riddles?</span>
            </a>
            <a href="./add-riddle.html" title="send riddles" class="w-1/4 bg-yellow-600 p-3 rounded flex flex-col items-center justify-between hover:bg-yellow-800 group">
            <img src="images/send-letter.png" alt="letter" class="w-8  md:w-16 mt-2"/>
            <span style="font-family: 'Knewave', cursive;" class="text-xs text-white">send us <br />a riddle?</span>
            </a>
            <a href="./all-riddles.html" title="all riddles" class="w-1/4 bg-black p-2 rounded flex flex-col items-center justify-center hover:bg-gray-900 group">
            <img src="images/cat-eyes.gif" alt="cat eyes" class="w-8 h-8 md:w-16 md:h-16"/>
            <span style="font-family: 'Knewave', cursive;" class="text-xs text-yellow-200 group-hover:text-white">see all riddles?</span>
            </a>
        </nav>

        <section class="flex flex-col items-center justify-center">
            <div id="fb-root"></div>
            <div
                class="fb-share-button"
                data-href="https://ethyl2.github.io/riddles/"
                data-layout="button"
                data-lazy="true"
            ></div>
            <div class="flex items-center justify-center text-yellow-200">
                <a
                    href="https://github.com/ethyl2/riddles"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="p-1 rounded hover:bg-white"
                    title="github repo"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                    focusable="false" width="1.73em" height="1.5em" style="
                                        -ms-transform: rotate(360deg);
                                        -webkit-transform: rotate(360deg);
                                        transform: rotate(360deg);
                                    " preserveAspectRatio="xMidYMid meet" viewBox="0 0 1227.825 1000">
                    <path
                        d="M1078.94-.985c-33.192-.491-110.295 10.777-239.027 96.936c-70.161-17.535-144.812-26.188-219.591-26.188c-82.278 0-165.425 10.448-242.965 31.719C192.534-24.605 110.955 1.234 110.955 1.234c-53.258 133.183-20.347 231.788-10.344 256.277C38.014 325.069-.2 411.338-.2 517.07c0 79.822 9.085 151.416 31.281 213.653c1.231 4.803.832 3.732 2.906 7.844c4.89 12.884 10.327 25.39 16.438 37.468c2.094 4.346 4 7.563 4 7.563c62.395 116.307 185.396 191.438 404.244 215.028l330.995.375c233.392-23.144 345.386-98.499 396.994-215.591l3.281-7.625c4.89-11.828 9.153-24.135 20.813-65.562c11.659-41.427 16.875-113.172 16.875-193.185c0-114.755-43.1-206.577-113.092-276.434c12.231-39.48 28.57-127.158-16.313-239.402c0 0-6.293-1.995-19.281-2.188zM818.1 420.133c53.893-.117 100.057 9.136 134.717 45.499v.031c43.369 45.541 68.749 100.525 68.749 159.778c0 276.658-177.932 284.183-397.4 284.183c-219.506 0-397.4-38.336-397.4-284.183c0-58.861 25.009-113.516 67.843-158.872c71.451-75.59 192.365-35.562 329.558-35.562c70.423-.011 136.564-10.75 193.935-10.875zm-408.807 81.468c-45.666 0-82.687 61.741-82.687 137.936c0 76.206 37.019 137.967 82.687 137.967c45.666 0 82.687-61.761 82.687-137.967c0-76.184-37.019-137.881-82.687-137.936zm443.649 0c-45.666 0-82.687 61.741-82.687 137.936c0 76.206 37.019 137.967 82.687 137.967c45.666 0 82.687-61.761 82.687-137.967c0-76.184-37.019-137.881-82.687-137.936z"
                        fill="black" />
                    </svg>
                    <span class="sr-only">GitHub Repo</span>
                </a>
                <p class="text-sm font-semibold">Copyright <span id="current-year">2022</span> Heather Nuffer et al.</p>
            </div>
        </section>
    </footer>

    <script src='./js/facebookShare.js' async defer></script>
    <script src='./js/riddles.js' async defer></script>
    <script>
        const currentRoomEl = document.getElementById('current-room')
        const roomNameEls = document.getElementsByClassName('room-name')
        const currentRiddleEl = document.getElementById('current-riddle')
        const riddleAnswerForm = document.getElementById('answer-form')
        const answerInput = document.getElementById('riddle-answer')
        const responseEl = document.getElementById('response')
        const submitButton = document.getElementById('submit')
        const giveUpButton = document.getElementById('give-up')
        const homeButton = document.getElementById('go-home')
        let currentRiddle

        setRoom()

        window.addEventListener('load', () => {
            getCurrentYear()
            
            currentRiddle = getRiddle() 
            currentRiddleEl.textContent = currentRiddle['question']
        })

        function getCurrentYear() {
            const currentYear = new Date().getFullYear();
            document.getElementById('current-year').textContent = currentYear;
        }

        function setRoom() {
            const searchParams = new URLSearchParams(window.location.search);
            const paramsObj = Object.fromEntries(searchParams.entries());
            const roomSlug = paramsObj.room
            currentRoomEl.src = `./images/${roomSlug}.png`

            const formattedRoomName = roomSlug
                .split('-')
                // .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ')
        
            Array.from(roomNameEls).forEach(roomNameEl => {
                roomNameEl.textContent = formattedRoomName
            })

            document.title = `${formattedRoomName} | riddles in the dark`
        }


        function getRiddle() {
            // Read the randomized riddle index array from localStorage.
            let randomizedRiddles = JSON.parse(window.localStorage.getItem("riddles_in_the_dark")) || []
            if (randomizedRiddles.length === 0) {
            // This is either the first time we visit this page or we are out of riddles, so we must create a new randomized storage
            randomizedRiddles = getRandomIndexList()
            }
            // Set the current riddle from the first index in the randomized array
            const currentRiddle = riddles[randomizedRiddles[0]]
            // Remove the current riddle index
            randomizedRiddles.splice(0, 1)
            // Save new array to localStorage for next time
            window.localStorage.setItem("riddles_in_the_dark", JSON.stringify(randomizedRiddles))

            return currentRiddle
        }

        riddleAnswerForm.addEventListener('submit', handleAnswer)

        function handleAnswer(e) {
            e.preventDefault()

            // removes "a " or "an " if present at the start of a user's answer
            const userAnswer = answerInput.value.trim().toLowerCase()
            if (userAnswer.length > 1) {
                const aCheck = userAnswer.slice(0, 2)
                if (aCheck === "a ") {
                    userAnswer = userAnswer.slice(2)
                }
            }
            if (userAnswer.length > 2) {
                const aCheck = userAnswer.slice(0, 3)
                if (aCheck === "an ") {
                    userAnswer = userAnswer.slice(3)
                }
            }

            const answerIndex = currentRiddle.answer.indexOf(userAnswer)
            if (answerIndex !== -1) {
                responseEl.classList.remove('text-red-500')
                responseEl.classList.add('text-black', 'pt-4')
                responseEl.textContent = `congratulations, smarty pants! ${currentRiddle.answer[answerIndex]} is correct & you are now allowed to leave.`
                giveUpButton.classList.add('hidden')
                riddleAnswerForm.classList.add('hidden')
                
                homeButton.classList.remove('hidden')
            } else {
                responseEl.classList.remove('text-black', 'pt-4')
                responseEl.classList.add('text-red-500')
                responseEl.textContent = 'sorry, not what I was looking for. try again.'
            }
        }

        answerInput.addEventListener('input', () => {
            if (answerInput.value.length > 0) {
            submitButton.disabled = false
            submitButton.classList.remove('bg-gray-500', 'cursor-not-allowed')
            submitButton.classList.add('bg-black', 'hover:bg-gray-800', 'focus:bg-gray-600')
            } else {
            submitButton.classList.remove('bg-black', 'hover:bg-gray-800', 'focus:bg-gray-600')
            submitButton.classList.add('bg-gray-500', 'cursor-not-allowed')
            submitButton.disabled = true
            }
      })

      const vowels = ['a', 'e', 'i', 'o', 'u']
      giveUpButton.addEventListener('click', () => {
        giveUpButton.classList.add('hidden')
        riddleAnswerForm.classList.add('hidden')
        responseEl.classList.add('pt-4')
        responseEl.textContent = `ok, better luck next time...`
        setTimeout(() => {
            responseEl.textContent = `the answer you seek is a${vowels.includes(currentRiddle.answer[0][0].toLowerCase()) ? 'n' : ''} ${currentRiddle.answer[0]}.`
        }, 1500)
        setTimeout(() => {
            responseEl.textContent = `i'll let you leave...this time...`
            homeButton.classList.remove('hidden')
        }, 2500)
      })
  </script>
</body>
</html>
